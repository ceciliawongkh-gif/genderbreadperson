<script>
    function getSliderValue(id) {
        return parseInt(document.getElementById(id).value);
    }
    
    function updateLabels(sliderId, value) {
        const leftId = sliderId === 'genderIdentity' ? 'giLabelLeft' :
                      sliderId === 'genderExpression' ? 'geLabelLeft' :
                      sliderId === 'biologicalSex' ? 'sexLabelLeft' : 'soLabelLeft';
        const rightId = sliderId === 'genderIdentity' ? 'giLabelRight' :
                       sliderId === 'genderExpression' ? 'geLabelRight' :
                       sliderId === 'biologicalSex' ? 'giLabelRight' : 'soLabelRight';
        const leftLabel = document.getElementById(leftId);
        const rightLabel = document.getElementById(rightId);
        const leftPct = 100 - value;
        leftLabel.textContent = `${leftPct}% ${leftLabel.dataset.original || leftLabel.textContent.split('%')[1] || leftLabel.textContent}`;
        rightLabel.textContent = `${value}% ${rightLabel.dataset.original || rightLabel.textContent.split('%')[1] || rightLabel.textContent}`;
    }
    
    function updateColorViz() {
        const gi = getSliderValue('genderIdentity');
        const ge = getSliderValue('genderExpression');
        const sex = getSliderValue('biologicalSex');
        const so = getSliderValue('sexualOrientation');
        
        // Blend all sliders into harmonious hue/saturation
        const avg = (gi + ge + sex + so) / 4;
        const hue = (avg * 360 / 100) % 360;
        const sat = 65 + (Math.sin(Date.now() / 800 + hue / 60) * 15);
        const light = 55 + (gi / 100 * 15);
        
        const patch = document.getElementById('colorPatch');
        patch.style.background = `radial-gradient(circle at 30% 30%, 
            hsl(${hue}, ${sat}%, ${light + 10}%), 
            hsl(${(hue + 90 + gi/5)%360}, ${sat + 10}%, ${light}%), 
            hsl(${(hue + 180 + ge/5)%360}, ${sat}%, ${light - 5}%), 
            hsl(${(hue + 270 + (sex+so)/10)%360}, ${sat - 10}%, ${light + 5}%)
        `;
        
        // Animate shimmer intensity based on sliders
        patch.style.animationDuration = `${3 + (100 - avg)/50}s`;
    }
    
    ['genderIdentity', 'genderExpression', 'biologicalSex', 'sexualOrientation'].forEach(id => {
        const slider = document.getElementById(id);
        const valueDisplay = document.getElementById(id === 'genderIdentity' ? 'giValue' :
                                                  id === 'genderExpression' ? 'geValue' :
                                                  id === 'biologicalSex' ? 'sexValue' : 'soValue');
        const leftLabel = document.getElementById(id === 'genderIdentity' ? 'giLabelLeft' :
                                               id === 'genderExpression' ? 'geLabelLeft' :
                                               id === 'biologicalSex' ? 'sexLabelLeft' : 'soLabelLeft');
        const rightLabel = document.getElementById(id === 'genderIdentity' ? 'giLabelRight' :
                                                id === 'genderExpression' ? 'geLabelRight' :
                                                id === 'biologicalSex' ? 'sexLabelRight' : 'soLabelRight');
        
        // Store original labels
        leftLabel.dataset.original = leftLabel.textContent.split('%')[1]?.trim() || leftLabel.textContent;
        rightLabel.dataset.original = rightLabel.textContent.split('%')[1]?.trim() || rightLabel.textContent;
        
        slider.addEventListener('input', e => {
            const value = parseInt(e.target.value);
            valueDisplay.textContent = `${value}%`;
            updateLabels(id, value);
            updateColorViz(); // Now called every time
        });
    });
    
    function shareSpectrum() {
        const gi = getSliderValue('genderIdentity');
        const ge = getSliderValue('genderExpression');
        const sex = getSliderValue('biologicalSex');
        const so = getSliderValue('sexualOrientation');
        const text = `ðŸŒˆ My Spectrum of Us: Identity ${gi}% | Expression ${ge}% | Sex ${sex}% | Orientation ${so}% #SpectrumOfUs`;
        navigator.clipboard.writeText(text).then(() => {
            const btn = event.target;
            const original = btn.textContent;
            btn.textContent = 'Copied! âœ¨';
            setTimeout(() => btn.textContent = original, 2000);
        }).catch(() => alert(text));
    }
    
    // Initial setup
    updateColorViz();
    
    // Image error handling
    document.getElementById('genderbread-img').onerror = function() {
        console.warn('Genderbread image not found');
        this.src = 'https://via.placeholder.com/1024x722/764ba2/ffffff?text=Upload+Genderbread+Image'; // Fallback
    };
</script>
